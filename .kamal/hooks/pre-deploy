#!/usr/bin/env bash

set -e

echo "Running database migrations on current container..."

if [ "$KAMAL_COMMAND" = "rollback" ]; then
  echo "Skipping migrations for rollback"
  exit 0
fi

# Skip migrations during initial setup - no container exists yet
# Migrations will run automatically when the container first boots
if [ "$KAMAL_COMMAND" = "setup" ]; then
  echo "Skipping migrations during initial setup - will run on first boot"
  exit 0
fi

kamal app exec --primary --reuse --no-interactive 'bin/rails db:prepare'

echo "âœ… Database migrations completed successfully"
