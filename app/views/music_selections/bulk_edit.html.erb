<%= turbo_frame_tag "music_selections" do %>
  <div class="pt-8 gap-4">
    <div class="flex justify-between items-center mb-4">
      <h2>Edit Music Selections</h2>
    </div>

    <%= form_with url: bulk_update_contest_entry_selections_path(entry_id: @contest_entry.id),
                  method: :patch,
                  data: { controller: "music-order" } do |f| %>
      <div class="space-y-4" data-music-order-target="list">
        <% @music_selections.each_with_index do |ms, index| %>
          <div class="p-4 bg-white rounded-lg border border-gray-300"
               data-music-order-target="item"
               data-id="<%= ms.id %>">
            <div class="flex items-center gap-4">
              <div class="flex flex-col gap-1">
                <button type="button"
                        class="p-1 text-gray-500 hover:text-gray-700 disabled:opacity-30"
                        data-action="music-order#moveUp"
                        <%= 'disabled' if index == 0 %>>
                  ▲
                </button>
                <button type="button"
                        class="p-1 text-gray-500 hover:text-gray-700 disabled:opacity-30"
                        data-action="music-order#moveDown"
                        <%= 'disabled' if index == @music_selections.size - 1 %>>
                  ▼
                </button>
              </div>

              <%= hidden_field_tag "music_selections[][id]", ms.id %>
              <%= hidden_field_tag "music_selections[][position]", index + 1,
                                   data: { music_order_target: "position" } %>

              <div class="flex-1 grid grid-cols-2 gap-4">
                <% if ms.prescribed? %>
                  <%= hidden_field_tag "music_selections[][title]", ms.title %>
                  <%= hidden_field_tag "music_selections[][composer]", ms.composer %>
                  <div>
                    <%= label_tag nil, "Title", class: "block text-sm font-medium text-gray-700" %>
                    <div class="text-field w-full bg-gray-100 cursor-not-allowed"><%= ms.title %></div>
                  </div>
                  <div>
                    <%= label_tag nil, "Composer", class: "block text-sm font-medium text-gray-700" %>
                    <div class="text-field w-full bg-gray-100 cursor-not-allowed"><%= ms.composer %></div>
                  </div>
                <% else %>
                  <div>
                    <%= label_tag "music_selections[][title]", "Title", class: "block text-sm font-medium text-gray-700" %>
                    <%= text_field_tag "music_selections[][title]", ms.title,
                                       class: "text-field w-full" %>
                  </div>
                  <div>
                    <%= label_tag "music_selections[][composer]", "Composer", class: "block text-sm font-medium text-gray-700" %>
                    <%= text_field_tag "music_selections[][composer]", ms.composer,
                                       class: "text-field w-full" %>
                  </div>
                <% end %>
              </div>

              <% if ms.prescribed? %>
                <span class="px-2 py-1 text-xs font-medium text-blue-800 bg-blue-100 rounded">
                  Prescribed
                </span>
              <% end %>
            </div>
          </div>
        <% end %>
      </div>

      <div class="flex justify-end gap-2 mt-6">
        <%= link_to "Cancel",
                    contest_entry_path(@contest_entry.contest, @contest_entry),
                    class: "btn-secondary",
                    data: { turbo_frame: "_top" } %>
        <%= f.submit "Save", class: "btn-primary" %>
      </div>
    <% end %>
  </div>
<% end %>
