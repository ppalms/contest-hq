<%= turbo_frame_tag "music_slot_prescribed" do %>
  <div class="p-6 bg-white rounded-lg border-2 border-blue-500">
    <div class="mb-4">
      <h3 class="text-lg font-semibold text-gray-900">Select Prescribed Music</h3>
      <p class="text-sm text-gray-600">Choose from the <%= @contest_entry.large_ensemble.school.school_class.name %> prescribed list</p>
    </div>

    <%= form_with(url: select_prescribed_contest_entry_selections_path(entry_id: @contest_entry.id, position: @position), method: :get, class: "mb-4", data: { turbo_frame: "music_slot_prescribed" }) do |f| %>
      <%= f.hidden_field :position, value: @position %>
      <div class="flex gap-2">
        <%= f.text_field :search, value: params[:search], placeholder: "Search by title or composer...", class: "text-field flex-1", autofocus: true %>
        <%= f.submit "Search", class: "btn-primary" %>
      </div>
    <% end %>

    <div class="max-h-96 overflow-y-auto space-y-2 mb-4">
      <% if params.key?(:search) %>
        <% if @prescribed_music.any? %>
          <% @prescribed_music.each do |music| %>
            <% is_selected = @current_prescribed_selection&.prescribed_music_id == music.id %>
            <%= button_to add_prescribed_contest_entry_selections_path(entry_id: @contest_entry.id, prescribed_music_id: music.id, position: @position),
                          method: :post,
                          class: "w-full text-left p-3 rounded border #{is_selected ? 'border-green-500 bg-green-50' : 'border-gray-300 bg-white hover:bg-gray-50'}" do %>
              <div class="font-medium text-gray-900"><%= music.title %></div>
              <div class="text-sm text-gray-600"><%= music.composer %></div>
              <% if is_selected %>
                <span class="inline-block mt-1 px-2 py-1 text-xs font-semibold text-green-800 bg-green-200 rounded">Currently Selected</span>
              <% end %>
            <% end %>
          <% end %>
        <% else %>
          <p class="text-sm text-gray-600 italic py-4 text-center">
            No prescribed music found<%= " matching \"#{params[:search]}\"" if params[:search].present? %>
          </p>
        <% end %>
      <% else %>
        <p class="text-sm text-gray-500 italic py-4 text-center">
          Use the search above to find prescribed music
        </p>
      <% end %>
    </div>

    <div class="flex justify-end">
      <%= link_to "Cancel",
        bulk_edit_prescribed_slot_contest_entry_selections_path(entry_id: @contest_entry.id),
        class: "btn-secondary",
        data: { turbo_frame: "music_slot_prescribed" } %>
    </div>
  </div>
<% end %>
