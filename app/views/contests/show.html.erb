<%= render "shared/entity_detail",
      entity: @contest,
      title: @contest.name,
      entity_partial: "contests/contest",
      actions: (capture do %>
        <% if current_user.account_admin? %>
          <%= link_to "Edit", edit_contest_path(@contest), class: "btn-secondary-sm" %>
          <%= button_to "Delete",
          @contest,
          method: :delete,
          class: "btn-danger-sm",
          form: {
            data: {
              turbo_confirm: "Are you sure?",
            },
          } %>
        <% end %>
      <% end) do %>

  <%# TODO: only show if director conducts an eligible large ensemble %>
  <% if current_user.director? %>
    <div class="pt-8">
      <div class="flex justify-between">
        <h2>Entries</h2>

        <%= link_to "Register",
        new_contest_entry_path(contest_id: @contest.id),
        class: "btn-primary-sm",
        data: {
          turbo_frame: "_top",
        } %>
      </div>

      <div class="pt-4">
        <%= render partial: "my_entries",
        locals: {
          entries: @contest.contest_entries.where(user_id: current_user.id),
        } %>
      </div>
    </div>
  <% end %>

  <% if @contest.managers.any? || current_user.account_admin? %>
    <div class="pt-8">
      <div class="flex justify-between">
        <h2>Managers</h2>

        <% if current_user.account_admin? %>
          <%= link_to "Assign Managers",
          contest_managers_path(@contest),
          class: "btn-primary-sm" %>
        <% end %>
      </div>

      <div class="pt-4">
        <% if @contest.managers.empty? %>
          <p class="text-sm text-gray-500">
            No managers have been assigned to this contest.
          </p>
        <% else %>
          <div class="text-sm">
            <% @contest.managers.each do |manager| %>
              <div class="flex justify-between border-b py-1">
                <div>
                  <%= manager.first_name %>
                  <%= manager.last_name %>
                </div>
                <div class="text-gray-500">
                  <%= manager.email %>
                </div>
              </div>
            <% end %>
          </div>
        <% end %>
      </div>
    </div>
  <% end %>

  <%# Manager Onboarding Section %>
  <% if current_user.manages_contest(@contest.id) && @contest.setup_status == "Needs Setup" %>
    <div class="pt-6">
      <div class="bg-blue-50 border border-blue-200 rounded-lg p-6">
        <div class="flex items-start gap-3">
          <div class="text-2xl">üëã</div>
          <div class="flex-1">
            <p class="flex flex-col text-blue-800 mb-4">
              <strong>Getting Started</strong>
              <span>This contest needs to be configured before scheduling can
                begin.</span>
            </p>

            <div class="mb-4">
              <h4 class="font-medium text-blue-800 mb-2">Setup Checklist:</h4>
              <ul class="space-y-1 text-blue-800">
                <li class="flex items-center gap-2">
                  <span class="<%= @contest.rooms.any? ? 'text-green-600' : 'text-gray-400' %>">
                    <%= @contest.rooms.any? ? "‚úì" : "‚òê" %>
                  </span>
                  Add performance rooms
                </li>
                <li class="flex items-center gap-2">
                  <span
                    class="<%= @contest.performance_phases.any? ? 'text-green-600' : 'text-gray-400' %>"
                  >
                    <%= @contest.performance_phases.any? ? "‚úì" : "‚òê" %>
                  </span>
                  Configure performance phases (e.g., warm-up, performance,
                  sight-reading)
                </li>
                <li class="flex items-center gap-2">
                  <span
                    class="<%= @contest.contest_start && @contest.contest_end ? 'text-green-600' : 'text-gray-400' %>"
                  >
                    ‚òê
                  </span>
                  Review contest settings
                </li>
              </ul>
            </div>

            <%= link_to "Begin Setup ‚Üí", contest_setup_path(@contest), class: "btn-primary" %>
          </div>
        </div>
      </div>
    </div>
  <% end %>

  <div class="pt-8">
    <div class="flex justify-between">
      <h2>Schedule</h2>

      <% if (@contest.performance_phases.length || 0) > 0 %>
        <%= link_to "View Schedule",
        @schedule,
        class: "btn-primary-sm",
        data: {
          turbo_frame: "_top",
        } %>
      <% end %>
    </div>

    <div class="pt-4">
      <% if @contest.schedules.any? && current_user.manages_contest(@contest.id) && @contest.performance_phases&.length == 0 %>
        <p class="text-sm text-gray-500">
          Contest schedule is not configured -
          <%= link_to "click here", schedule_path(@schedule), class: "italic hover:underline" %>
          to begin.
        </p>
      <% elsif @contest.performance_phases.length > 0 %>
        <ol class="list-decimal text-sm pl-4">
          <% @contest.performance_phases&.each do |phase| %>
            <li>
              <div class="flex justify-between border-b py-1">
                <div>
                  <%= phase.name %>
                  -
                  <%= phase.duration %>
                  min.
                </div>
                <div class="text-gray-500">
                  <%= phase.room.name %>
                  -
                  <%= phase.room.room_number %>
                </div>
              </div>
            </li>
          <% end %>
        </ol>
      <% else %>
        <div class="text-sm text-gray-500">
          A schedule has not been posted for this contest.
        </div>
      <% end %>
  </div>

<% end %>
</div>
