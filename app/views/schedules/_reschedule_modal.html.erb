<div id="reschedule_modal" class="fixed inset-0 bg-gray-600 bg-opacity-50 overflow-y-auto h-full w-full z-50">
  <div class="relative top-20 mx-auto p-5 border w-96 shadow-lg rounded-md bg-white">
    <div class="mt-3 text-center">
      <h3 class="text-lg font-medium text-gray-900 mb-4">
        Reschedule <%= contest_entry.large_ensemble.name %>
      </h3>
      
      <div class="text-sm text-gray-600 mb-4">
        <p><strong>School:</strong> <%= contest_entry.large_ensemble.school.name %></p>
        <% if contest_entry.large_ensemble.performance_class.abbreviation.present? %>
          <p><strong>Class:</strong> <%= contest_entry.large_ensemble.performance_class.abbreviation %></p>
        <% end %>
      </div>

      <div class="text-sm text-gray-600 mb-4">
        <p><strong>Current Schedule:</strong></p>
        <% current_blocks.each do |block| %>
          <p><%= block.performance_phase&.name %> - <%= block.start_time.strftime("%a %-m/%d %l:%M %p") %></p>
        <% end %>
      </div>

      <%= form_with url: update_schedule_entry_path(schedule, contest_entry), 
                    method: :patch, 
                    local: false,
                    data: { turbo_frame: "_top" },
                    class: "space-y-4" do |form| %>
        
        <div>
          <%= form.label :target_day_id, "Select Day:", class: "block text-sm font-medium text-gray-700" %>
          <%= form.select :target_day_id, 
                          options_from_collection_for_select(schedule_days, :id, 
                            ->(day) { day.schedule_date.strftime("%a %-m/%d") }),
                          { prompt: "Choose a day" },
                          { class: "mt-1 block w-full border border-gray-300 rounded-md px-3 py-2", required: true } %>
        </div>

        <div>
          <%= form.label :target_time, "New Time:", class: "block text-sm font-medium text-gray-700" %>
          <%= form.time_field :target_time, 
                              class: "mt-1 block w-full border border-gray-300 rounded-md px-3 py-2", 
                              required: true %>
        </div>

        <div>
          <%= form.label :reschedule_method, "Reschedule Method:", class: "block text-sm font-medium text-gray-700" %>
          <div class="mt-2 space-y-2">
            <label class="flex items-center">
              <%= form.radio_button :reschedule_method, "swap", class: "mr-2", required: true %>
              <span class="text-sm">Swap time slots with existing entry</span>
            </label>
            <label class="flex items-center">
              <%= form.radio_button :reschedule_method, "shift", class: "mr-2", required: true %>
              <span class="text-sm">Shift other entries to make room</span>
            </label>
          </div>
        </div>

        <div class="flex justify-between pt-4">
          <button type="button" 
                  onclick="document.getElementById('modal_container').innerHTML = ''" 
                  class="px-4 py-2 bg-gray-300 text-gray-700 rounded-md hover:bg-gray-400">
            Cancel
          </button>
          <%= form.submit "Reschedule", 
                          class: "px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700" %>
        </div>
      <% end %>
    </div>
  </div>
</div>